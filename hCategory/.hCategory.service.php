<?php
  class hCategoryService extends hService { private $hCategoryDatabase; private $hFile; public function hConstructor() {        if (!$this->isLoggedIn()) { $this->JSON(-6); return; } if (!$this->inGroup('Website Administrators')) { $this->JSON(-1); return; } } public function newCategory() {        $this->hCategoryDatabase = $this->database('hCategory'); $this->hFile = $this->library('hFile');  if (!isset($_GET['hCategoryParentId'])) { $this->JSON(-5); return; } if (empty($_GET['hCategoryName'])) { $this->JSON(-5); return; }  $categoryParentId = (int) $_GET['hCategoryParentId']; if (!$this->hCategories->hasPermission($categoryParentId, 'rw')) { $this->JSON(-1); return; } $categoryPath = $this->getCategoryPath($categoryParentId); $categoryName = $_GET['hCategoryName']; $categoryNewPath = $this->getConcatenatedPath( $categoryPath, $categoryName );  if (!$this->categoryExists($categoryNewPath)) { $categoryId = $this->hFile->newDirectory( $categoryPath, $categoryName ); preg_match('/\d+/', $categoryId, $matches); $this->JSON( array( 'hCategoryId' => $matches[0], 'hCategoryParentId' => (string) $categoryParentId, 'hCategoryName' => $categoryName ) ); return; } else {  $this->JSON(-3); return; } } public function deleteCategories() {        $this->hFile = $this->library('hFile'); if (!isset($_GET['hCategories']) || !is_array($_GET['hCategories'])) { $this->JSON(-5); return; } foreach ($_GET['hCategories'] as $categoryId) { if (!$this->hCategories->hasPermission($categoryId, 'rw')) { $this->JSON(-1); return; } } foreach ($_GET['hCategories'] as $categoryId) { $this->hFile->delete($this->getCategoryPath((int) $categoryId)); } $this->JSON(1); return; } } ?>